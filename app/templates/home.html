<!--home.html-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Utama</title>
    <link rel="stylesheet" href="../static/styles/home.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../static/scripts/home_chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/14.6.3/nouislider.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap"></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <a href="{{ url_for('home') }}" class="active">Halaman Utama</a>
            <a href="{{ url_for('show_aftersales_management') }}">Aftersales</a>
            <a href="{{ url_for('show_aftersales_form') }}">Borang Aftersales</a>
            <a href="{{ url_for('show_job_management') }}">Tugas</a>
            <a href="{{ url_for('show_job_form') }}">Borang Tugas</a>
            <a href="{{ url_for('show_staff_profile') }}">Profil</a>
            <a href="#" onclick="confirmLogout()">Log Keluar</a>
        </div>
        <div class="content-container">
            <img src="../static/images/wgk1.png" alt="Global Komited Sdn Bhd Logo" class="logo"><br>          
            <div class="content">
                <br>
                <hr>
                <!-- Top 5 Most Profitable Jobs -->
                <div class="top-jobs-container">
                    <h4>Top 5 Most Profitable Jobs</h4>
                    <table class="top-jobs-table">
                        <thead>
                            <tr>
                                <th>Job No</th>
                                <th>Tajuk</th>
                                <th>Nama Pelanggan</th>
                                <th>Keuntungan (RM)</th>
                            </tr>
                        </thead>
                        <tbody id="topJobsTableBody">
                            <!-- Data will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <br>
                <hr><br>
                <div class="chart-container">
                    <!-- Chart 1: Job Costs and Profits -->
                    <div class="chart-item">
                        <h4>Purata Kos dan Untung Per Unit Kenderaan</h4>
                        <canvas id="jobCostsProfitsChart"></canvas>
                    </div>
                    <!-- Chart 2: Job Profitability Trends -->
                    <div class="chart-item">
                        <h4>Trend Keuntungan Pekerjaan Mengikut Tarikh Penghantaran</h4>
                        <canvas id="jobProfitabilityTrendChart"></canvas>
                        <div class="slider-container">
                            <label for="dateRangeSlider">Pilih Julat Tarikh:</label>
                            <input type="range" min="0" max="100" value="100" class="slider" id="dateRangeSlider">
                            <span id="dateRangeLabel">(100 data points)</span>
                        </div>
                    </div>
                    <!-- Chart 3: Job Quantity -->
                    <div class="chart-item">
                        <h4>Jumlah Kuantiti Mengikut Jenis Kenderaan</h4>
                        <canvas id="jobQuantityChart"></canvas>
                    </div>
                    <!-- Chart 4: Aftersales Bar Chart -->
                    <div class="chart-item">
                        <h4>Jumlah Aftersales Mengikut Jenis Chassis</h4>
                        <canvas id="aftersalesBarChart"></canvas>
                    </div>
                </div>
                <br>
                <hr>
            </div>
        </div>
    </div>

    <script>
        function confirmLogout() {
            if (confirm("Adakah anda pasti ingin log keluar?")) {
                window.location.href = "{{ url_for('logout') }}";
            }
        }

        async function fetchTopJobs() {
            const response = await fetch('/api/top-jobs');
            const topJobs = await response.json();
            const tableBody = document.getElementById('topJobsTableBody');
            tableBody.innerHTML = ''; // Clear any existing rows

            topJobs.forEach(job => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${job.jobNo}</td>
                    <td>${job.title}</td>
                    <td>${job.custName}</td>
                    <td>${job.totalProfit}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Call the function to fetch and display the top jobs when the page loads
        window.onload = fetchTopJobs;
    </script>
</body>
</html>
