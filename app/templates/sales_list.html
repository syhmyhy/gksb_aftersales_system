<!-- sales_list.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rekod Jualan & Pemasaran</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../static/styles/styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.js"></script>
    <script src="../static/scripts/sales_list.js" defer></script>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <ul>
            <li class="{% if request.endpoint == 'select_page' %}active{% endif %}">
                <a href="{{ url_for('select_page') }}">
                    <i class="fas fa-arrow-left"></i> Halaman Utama
                </a>
            </li>
            <li class="{% if request.endpoint == 'sales_marketing_home' %}active{% endif %}">
                <a href="{{ url_for('sales_marketing_home') }}">
                    <i class="fas fa-home"></i> Jualan & Pemasaran
                </a>
            </li>
            <li class="{% if request.endpoint == 'show_sales_form' %}active{% endif %}">
                <a href="{{ url_for('show_sales_form') }}">
                    <i class="fas fa-file-alt"></i> Borang Jualan & Pemasaran
                </a>
            </li>
            <li class="{% if request.endpoint == 'show_sales_list' %}active{% endif %}">
                <a href="{{ url_for('show_sales_list') }}">
                    <i class="fas fa-list"></i> Senarai Jualan & Pemasaran
                </a>
            </li>
        </ul>
    </nav>
    <header role="banner">
        <h2>Senarai Jualan & Pemasaran</h2>
    </header>
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash-{{ category }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <br><button onclick="exportTableToCSV('sales_records.csv')">Muat Turun Rekod Jualan & Pemasaran</button><br><br>
    <div class="table-container">
        <table id="salesTable" class="display">
            <thead>
                <tr>
                    <th>#</th> <!-- Row counter column -->
                    <th class="table-left-align">PIC/Jabatan</th>
                    <th class="table-left-align">Kaedah Pembelian</th>
                    <th class="table-left-align">Tajuk Tender</th>
                    <th class="table-left-align">Nama Pelanggan</th>
                    <th class="table-left-align">Jenis Chassis</th>
                    <th class="table-left-align">Model Chassis</th>
                    <th class="table-center-align">Kuantiti</th>
                    <th class="table-left-align">Tarikh Tender/Sebut Harga</th>
                    <th class="table-right-align">Harga(RM)/Unit</th>
                    <th class="table-right-align">Harga Total Tender(RM)</th>
                    <th class="table-right-align">Untung(RM)/Unit</th>
                    <th class="table-right-align">Keuntungan Total Tender(RM)</th>
                    <th class="table-right-align">Margin Keuntungan(%)</th>
                    <th class="table-left-align">Status</th>
                    <th class="table-left-align">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for sale in sales_records %}
                    <tr>
                        <td></td> <!-- Will be populated dynamically -->
                        <td class="table-left-align">{{ sale.salesPerson }}</td>
                        <td class="table-left-align">{{ sale.purchaseMethod }}</td>
                        <td class="table-left-align">{{ sale.tenderTitle }}</td>
                        <td class="table-left-align">{{ sale.custName }}</td>
                        <td class="table-left-align">{{ sale.chassisType }}</td>
                        <td class="table-left-align">{{ sale.chassisModel }}</td>
                        <td class="table-center-align">{{ sale.quantity }}</td>
                        <td class="table-left-align">{{ sale.tenderDate }}</td>
                        <td class="table-right-align">{{ sale.unitPrice| format_rm_currency }}</td>
                        <td class="table-right-align">{{ sale.tenderTotalPrice| format_rm_currency }}</td>
                        <td class="table-right-align">{{ sale.unitProfit| format_rm_currency }}</td>
                        <td class="table-right-align">{{ sale.tenderTotalProfit| format_rm_currency }}</td>
                        <td class="table-right-align">{{ sale.marginProfit }}</td>
                        <td class="table-left-align">{{ sale.notes }}</td>
                        <td class="table-left-align">
                            <a href="{{ url_for('edit_sales_form', salesID=sale.salesID) }}">Kemaskini</a>
                            <a href="{{ url_for('delete_sales_record', salesID=sale.salesID) }}" onclick="return confirm('Adakah anda pasti ingin memadam rekod ini?');">Padam</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
    </div>
</body>
</html>
